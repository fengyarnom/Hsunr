{% extends 'main.html' %}

{% block main %}
    <div class="login">

        <div class="header">
            ğŸ˜¸ ç™»å½•
        </div>

        <div class="alert alert-warning" role="alert">
          ã€ è«æ˜¥è€…ï¼Œæ˜¥æœæ—¢æˆï¼Œå† è€…äº”å…­äººï¼Œç«¥å­å…­ä¸ƒäººï¼Œæµ´ä¹æ²‚ï¼Œé£ä¹èˆé›©ï¼Œå’è€Œå½’ ã€
        </div>
        <div class="alert alert-danger disvisible" id="login_input_error" role="alert">
          ç”¨æˆ·åæˆ–å¯†ç ä¸ºç©ºï¼Œè¯·é‡æ–°è¾“å…¥
        </div>
        <form action="">

            <div class="form-floating mb-3">
              <input type="text" class="form-control" id="username" placeholder="ç”¨æˆ·å">
              <label for="username">ç”¨æˆ·å</label>
            </div>
            <div class="form-floating mb-3">
              <input type="password" class="form-control" id="password" placeholder="å¯†ç ">
              <label for="password">å¯†ç </label>
            </div>

            <button type="button" class="btn btn-primary" onclick="login()">ç™»å½•</button>
        </form>
    </div>
    <script>
        function input_box_normal() {
            document.getElementById("username").className = "form-control"
            document.getElementById("password").className = "form-control"
        }
        function input_box_error() {
            document.getElementById("username").className = "form-control is-invalid"
            document.getElementById("password").className = "form-control is-invalid"
        }
        function login() {
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;

            if(username === ""||password === ""){
                input_box_error()
                document.getElementById("login_input_error").innerText= "ç”¨æˆ·åæˆ–å¯†ç ä¸ºç©º"
                document.getElementById("login_input_error").className = "alert alert-danger"
            }else{
                input_box_normal()
                document.getElementById("login_input_error").className = "disvisible"
                let body = {
                    username : username,
                    password : password
                }
                fetch("/admin/login-check", {
                    method: "POST",
                    headers: {"Content-type": "application/json;charset=utf-8; charset=UTF-8"},
                    body: JSON.stringify(body)
                })
                .then(response => response.json())
                .then(retrun_data => {
                    if(retrun_data['code'] ===  301){
                        document.cookie="username="+username;
                        window.location.replace("/admin");
                    }
                    else{
                        input_box_error();
                        document.getElementById("login_input_error").innerText= "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°æ£€æŸ¥å¯†ç "
                        document.getElementById("login_input_error").className = "alert alert-danger"
                    }

                });
                }


        }

    </script>
{% endblock %}